{"version":3,"sources":["../src/sso-config/FacebookPassport.ts"],"names":[],"mappings":";;AAAA,qDAA+C;AAE/C,IAAI,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACnC,IAAI,gBAAgB,GAAG,OAAO,CAAC,mBAAmB,CAAC,CAAC,QAAQ,CAAC;AAE7D,8CAA8C;AAC9C;IAUI;QACI,IAAI,CAAC,QAAQ,GAAG,wBAAe,CAAC,EAAE,CAAC;QACnC,IAAI,CAAC,QAAQ,GAAG,wBAAe,CAAC,MAAM,CAAC;QAEvC,QAAQ,CAAC,GAAG,CAAC,IAAI,gBAAgB,CAAC;YAC1B,QAAQ,EAAE,IAAI,CAAC,QAAQ;YACvB,YAAY,EAAE,IAAI,CAAC,QAAQ;YAC3B,WAAW,EAAE,uEAAuE;YACpF,aAAa,EAAE,CAAC,IAAI,EAAE,aAAa,EAAE,QAAQ,CAAC;SACjD,EACD,CAAC,WAAW,EAAE,YAAY,EAAE,OAAO,EAAE,IAAI;YACrC,OAAO,CAAC,QAAQ,CAAE;gBACd,OAAO,CAAC,GAAG,CAAC,8BAA8B,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;gBACtE,kDAAkD;gBAClD,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;gBACvC,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,EAAE,CAAC;gBACzB,IAAI,CAAC,WAAW,GAAG,OAAO,CAAC,WAAW,CAAC;gBACvC,IAAI,CAAC,KAAK,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;gBACrC,QAAQ,CAAC,OAAO,CAAC,WAAW,GAAG,OAAO,CAAC,WAAW,CAAC;gBACnD,QAAQ,CAAC,OAAO,CAAC,KAAK,GAAG,OAAO,CAAC,MAAM,CAAC;gBACxC,QAAQ,CAAC,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC,EAAE,CAAC;gBACrC,QAAQ,CAAC,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;gBAChD,OAAO,CAAC,GAAG,CAAC,MAAM,GAAG,QAAQ,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;gBACnD,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;YAC/B,CAAC,CAAC,CAAC;QACP,CAAC,CACJ,CAAC,CAAC;QAEH,QAAQ,CAAC,aAAa,CAAC,CAAC,IAAI,EAAE,IAAI;YAC9B,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,eAAe,CAAC,CAAC,IAAI,EAAE,IAAI;YAChC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QACrB,CAAC,CAAC,CAAC;IACP,CAAC;CACJ;AACD,kBAAe,gBAAgB,CAAC","file":"FacebookPassport.js","sourcesContent":["import facebookAppAuth from './facebookOauth2';\r\n\r\nlet passport = require('passport');\r\nlet FacebookStrategy = require('passport-facebook').Strategy;\r\n\r\n// Creates a Passport configuration for Google\r\nclass FacebookPassport {\r\n\r\n    userId: string;\r\n    public displayName: string;\r\n    public email: string;\r\n    clientId: string;\r\n    secretId: string;\r\n    public profile: string;\r\n\r\n    \r\n    constructor() {\r\n        this.clientId = facebookAppAuth.id;\r\n        this.secretId = facebookAppAuth.secret;\r\n\r\n        passport.use(new FacebookStrategy({\r\n                clientID: this.clientId,\r\n                clientSecret: this.secretId,\r\n                callbackURL: \"http://fieldfindersystemtest.azurewebsites.net/auth/facebook/callback\",\r\n                profileFields: ['id', 'displayName', 'emails']\r\n            },\r\n            (accessToken, refreshToken, profile, done) => {\r\n                process.nextTick( () => {\r\n                    console.log('validating facebook profile:' + JSON.stringify(profile));\r\n                    // Insert user objet, check user oject in mongoose\r\n                    this.profile = JSON.stringify(profile);\r\n                    this.userId = profile.id;\r\n                    this.displayName = profile.displayName;\r\n                    this.email = profile.emails[0].value;\r\n                    passport.session.displayName = profile.displayName;\r\n                    passport.session.email = profile.emails;\r\n                    passport.session.userId = profile.id;\r\n                    passport.session.user = JSON.stringify(profile);\r\n                    console.log(\"User\" + passport.session.displayName);\r\n                    return done(null, profile);\r\n                });\r\n            }\r\n        ));\r\n\r\n        passport.serializeUser((user, done) => {\r\n            done(null, user);\r\n        });\r\n\r\n        passport.deserializeUser((user, done) => {\r\n            done(null, user);\r\n        });\r\n    }\r\n}\r\nexport default FacebookPassport;"],"sourceRoot":".."}